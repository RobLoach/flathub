id: net.lutris.Lutris
sdk: org.gnome.Sdk
runtime: org.gnome.Platform
runtime-version: "3.30"
command: lutris
#rename-icon: lutris
#rename-desktop-file: lutris.desktop
#rename-appdata-file: lutris.appdata.xml
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --socket=pulseaudio
  - --device=all
  - --share=network
  - --allow=multiarch
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.gnome.Mutter.DisplayConfig
  - --talk-name=org.gtk.vfs
  - --talk-name=org.gtk.vfs.*
  - --talk-name=ca.desrt.dconf
  - --filesystem=xdg-run/dconf
  - --filesystem=xdg-config/dconf:ro
  #- --system-talk-name=org.freedesktop.NetworkManager
  #- --system-talk-name=org.freedesktop.UPower
add-extensions:
  org.freedesktop.Platform.Compat.i386:
    directory: lib/i386-linux-gnu
    version: "18.08"
  org.freedesktop.Platform.Compat.i386.Debug:
    directory: lib/debug/lib/i386-linux-gnu
    version: "18.08"
    no-autodownload: true
  org.freedesktop.Platform.GL32:
    directory: lib/i386-linux-gnu/GL
    version: "1.4"
    versions: "18.08;1.4"
    subdirectories: true
    no-autodownload: true
    autodelete: false
    add-ld-path: lib
    merge-dirs: vulkan/icd.d;glvnd/egl_vendor.d;OpenCL/vendors
    download-if: active-gl-driver
    enable-if: active-gl-driver
cleanup:
  - /include
  - /lib/pkgconfig
modules:
  - name: xrandr
    sources:
      - type: archive
        url: "https://xorg.freedesktop.org/archive/individual/app/xrandr-1.5.0.tar.bz2"
        sha256: c1cfd4e1d4d708c031d60801e527abc9b6d34b85f2ffa2cadd21f75ff38151cd

  - name: pciutils
    no-autogen: true
    make-args:
      - OPT=-O2 -g
    make-install-args:
      - PREFIX=/app
      - SBINDIR=/app/bin
    sources:
      - type: archive
        url: "https://mirrors.edge.kernel.org/pub/software/utils/pciutils/pciutils-3.6.2.tar.gz"
        sha256: d5f9254f27bbda8243b345633e980144e6bd2af9c786bb8a152b904530aef599

  - name: winetricks
    no-autogen: true
    make-install-args:
      - PREFIX=/app
    sources:
      - type: archive
        url: "https://github.com/Winetricks/winetricks/archive/20180815.tar.gz"
        sha256: 6dc22357ea1f857b7283250f7c6a68b9dee97e672bbea9a9c45c573d73634200
    cleanup:
      - /share/bash-completion
      - /share/applications
      - /share/metainfo

  - name: lutris
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=/app --root=/
    ensure-writable:
      - easy-install.pth
      - setuptools.pth
    sources:
      - type: git
        url: "https://github.com/lutris/lutris.git"
        tag: v0.5.0-beta
    modules:

      - name: gnome-desktop
        sources:
          - type: archive
            url: "https://download.gnome.org/sources/gnome-desktop/3.30/gnome-desktop-3.30.2.tar.xz"
            sha256: 5475e693cb7ada801a36e8d16bc0dbb58930b793f455419b205cd9241d63d14c

      - name: python-evdev
        buildsystem: simple
        build-commands:
          - python3 setup.py install --prefix=/app --root=/
        ensure-writable:
          - easy-install.pth
          - setuptools.pth
        sources:
          - type: archive
            url: "https://github.com/gvalkov/python-evdev/archive/v1.1.2.tar.gz"
            sha256: 4403d4ee2d9682d17d292d5cfe0781d9ebfe119c7bb0f631fb59de3003bad49d

      - name: PyYAML
        buildsystem: simple
        build-commands:
          - python3 setup.py install --prefix=/app --root=/
        ensure-writable:
          - easy-install.pth
          - setuptools.pth
        sources:
          - type: archive
            url: "https://github.com/yaml/pyyaml/archive/4.2b2.tar.gz"
            sha256: 2d3ccbb9705eceaf36e495cfaba30277a59aa3f0a5e3c8cfffe760d89625e3d2

  - name: lutris-app-environment
    buildsystem: simple
    build-commands:
      - mkdir -p /app/lib/i386-linux-gnu
